1. perf log 使用
1.1.简介
说明：修改了原生的android log， 增加了perf id，这个perf log使用自己独立的perf缓存区，不会受到user版本影响而无法打印，无法被禁止输出。log等级固定为perf。logcat 时，perf log依然可以打印到终端。id 为LOG_ID_PERF。 而且自带了tc时间（tickcount）和tt时间（cputime），因此代码中实现的时候，都不需要自己再去添加时间； 开发在使用的时候不能随意添加，只有在关键点的地方才可以添加，否则会影响性能；

1.2.代码中如何使用
c++层：system/core/include/log/log.h

使用方法：

Android.mk包含 libcutils库和includes路径：

LOCAL_SHARED_LIBRARIES := libcutils

LOCAL_C_INCLUDES := system/core/include/utils

#include log.h

#define LOG_TAG XXX

ALOGP("[模块名] 类名:函数名 begin/end");

例：ALOGP("[Thirdparty] ThirdpartyService::onCreate() begin");

函数的开始和结束都输出一下Log。

java层：framework/base/core/Java/android/util/Log.java

使用方法：

import android.util.Log;

Log.p(tag(Java类名),"[模块名] 类名:函数名 begin/end")

例：Log.p（"ThirdpartyService", "[Thirdparty] ThirdpartyService::onCreate() begin");

函数的开始和结束都输出一下Log。

1.3.命令如何使用
logcat -b perf //查看perf 缓存区log

logcat -b perf -s XXX //查看perf 缓存区对应TAG的log，XXX指的是TAG。效果同：logcat -s XXX

logcat -b perf -c //清除perf缓存区log

logcat -g //查看四个缓冲区大小和占用情况，perflog存在perf缓冲区

2.常用 logcat 命令
2.1、log id 打印开关

//log id限制只针对除了ERROR,FATAL,PERF外其他等级log，以下默认此为前提

logcat -u 0//禁止所有log输出

logcat -u 0xffffffff//允许所有log输出

logcat -U LOGID_ANDROID//更改id为LOGID_ANDROID的log输出状态，即输出变为禁止输出，禁止变为输出

logcat -u 0x80000001//更改id为0x80000001的log输出状态，即输出变为禁止输出，禁止变为输出

2.2、log 等级打印开关

logcat -l 15//表示所有等级log都输出

logcat -l 0x1 //表示只允许等级为VERBOSE的信息输出

logcat -l ox2 表示只允许等级为DEBUG的信息输出

logcat -l 0x4 表示只允许等级为INFO的信息输出

logcat -l 0x8 表示只允许等级为WARN的信息输出

ERROR，ASSERT等级的信息不能禁止输出。

2.3、log输出开关，优先级高于1和2:

logcat -o 0//关闭log输出

logcat -o 1//打开log输出

2.4、log buffer大小设置

logcat -G 4M //设置所有缓冲区大小为4M，main,sytem,crash,perf

logcat -b main -G 4M //设置main缓冲区大小为4M

logcat -g //log buffer大小查看

2.5、log黑白名单

设置黑白名单。可以对UID,PID设置，也可以UID/PID一起设置。设置黑名单，前缀~

logcat -P ~520881 ~/78883 ~52189/8883' //对UID 520881，对PID78883，对UID/PID 52189/8883 设置黑名单。

logcat -P 520881 //对UID 520881设置白名单

logcat -p //查看黑白名单

2.6、log设置查看

logcat -k //查看当前允许输出的log等级

logcat -g //log buffer大小查看

logcat -s "log_tag1" "log_tag2" //只允许某些log_tag输出

logcat "log_tag1:s" "log_tag2:s" //不允许某些log_tag输出

logcat -b xxx//查看xxxbuffer 的 log，logbuffer环形缓冲区在system/core/include/log/log.h中log_id中定义。有main,radio,event,system,crash,security,error,perf,kernel

logcat -b main//查看main buffer log ，是我们平时正常使用的buffer，

logcat -b crash//程序crash相关的log

2.7、输出到文件

logcat -v threadtime -f /data/log/log -r2048 -n 49 //-v ：threadtime格式输出，-f指创建文件 /data/log/log，-r2048指每个文件大小20485k，-n 49 创建49+1个文件

3.常用 logk 命令
logk -e 0 //关闭 kernel log 输出，user版默认为0

logk -e 1 //使能 kernel log 输出

logk -p //查看 kernel log 状态

logk -f 文件 //打印 kernel log 到文件